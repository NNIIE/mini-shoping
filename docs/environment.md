# 개발 환경

<br>

## 목차
- [Language: Java 21](#language-java-21)
- [GC: G1 GC](#gc-g1-gc)
- [Framework: Spring Boot 3.4.4](#framework-spring-boot-344)
- [Database: MySQL 8.0](#database-mysql-80)
- [데이터 접근 기술: JPA](#데이터-접근-기술-jpa)
- [동적 쿼리 기술: JPQL](#동적-쿼리-기술-jpql)
- [테스트: JUnit 5 + Mockito](#테스트-junit-5--mockito)
- [Build Tool: Gradle](#build-tool-gradle)

---

<br>

### Language: Java 21
- OS 스레드와 직접 매칭되던 전통적인 자바 스레드의 한계를 개선한 Virtual 스레드
  - 스프링 MVC에서 요청마다 OS 스레드가 아닌 가상 스레드가 생성 (I/O 작업 블로킹 X)
  - 기존 스레드 대비 가상 스레드의 메모리 효율성 증가 (약 1MB -> 2KB)
  - 스택 트레이스가 보존되어 디버깅에 용이
  - I/O 작업 블로킹 문제를 해결하는 리액티브 프로그래밍의 장점을 계승
    - 기존 동기식 코드의 변경이 거의 없음 (리액티브 프로그래밍의 러닝커브 극복)
- 최적화된 G1 GC 알고리즘
- Spring, Hibernate, Gradle 등 주요 프레임워크 및 라이브러리와의 완전한 호환성
- JDK 8 대비 향상된 언어 기능
- 가장 장기간의 유지보수

| 항목          | JDK 8                            | JDK 17                               | JDK 21                                     |
|--------------|----------------------------------|--------------------------------------|--------------------------------------------|
| LTS 지원 기간  | 2030.12                          | 2029.09                              | 2031.09                                    |
| 주요 언어 특징  | - 람다<br>- Stream API<br>- Optional<br>- 인터페이스 Default 메서드 | - Record Class<br>- Sealed Class<br>- Switch 패턴 매칭(프리뷰)<br>- 텍스트 블록 | - Virtual Thread<br>- Scoped Values<br>-  Record 패턴 매칭<br>- String Templates (프리뷰) |
| 성능          | Parallel/CMS GC, C1/C2 Jit       | G1 GC / ZGC, C2 Jit | G1 GC 개선, ZGC 안정화         |
| 동시성 모델     | 전통적인 스레드 기반                  | - 개선된 ForkJoinPool<br>- CompletableFuture 강화    | Virtual Thread 기반의 경량 스레드 모델 도입 |
| 라이브러리 | 안정적이며 풍부                  | 대다수 프레임워크 및 라이브러리 완벽 대응            | 주요 프레임워크 완벽 대응, 일부 레거시 라이브러리는 제한 가능성 있음 |

<br>

### GC: G1 GC
웹 어플리케이션의 특성상 GC의 동시성과 처리량의 조화를 목표로 설계된 G1 GC를 선택했습니다.
- GC 작업이 어플리케이션이 실행되는 동안 같이 실행되기 때문에 최대 처리량에서 다소 손해를 보지만 Stop-the-world의 빈도가 낮습니다.
- G1 GC는 Region 기반의 설계로 전체 힙을 대상으로 수집하지 않고 우선순위가 높은 Region만 선택적으로 수집하기 때문에 GC 시간이 짧게 유지됩니다.
- `-XX:MaxGCPauseMillis` 옵션을 활용하면 다양한 트래픽 패턴에서도 예측 가능한 GC 시간을 유지할 수 있습니다.

| 항목            | Parallel GC                            | G1 GC                               | ZGC                                   |
|----------------|----------------------------------|--------------------------------------|--------------------------------------------|
| 기본 목표        | 높은 처리량 (Throughput)            | 예측 가능한 지연 시간 + 준수한 처리량         | 저지연 응답 시간                               |
| 기본 전략        | 모든 영역 병렬 수집 <br>(Young + Old 병렬 수집) | Region 기반 Young - Mixed GC  | Colored Pointer + Load/Store Barrier 기반의 동시 수집  |
| Full GC 빈도    | 빈번함 (Old 영역이 차면 발생) | 드물게 발생 (Humongous 객체 누적, Region 단편화, Mixed GC 실패 시) | 거의 발생하지 않음 (동시 수집 메모리 설계상 회피) |
| Stop-the-world | 수백ms ~ 수초 (힙 크기에 비례)         | 수십 ~ 수백ms (목표 설정 가능)             | < 1ms (힙 크기와 무관)                         |
| 처리량           | 매우 높음                          | 높음                                   |        중간                                  |
| 안정성 (Java 21) | 매우 안정적                         | 매우 안정적 + Mixed GC 압축 개선           | 안정적 (최근 안정화)                            |
| 최적 환경 | 배치 서비스 등의 응답 시간 중요하지 않은 환경 | 웹, API 서버 – 일관된 응답시간 + 적절한 Throughput 요구 환경 | 실시간 분석, 거래소, 게임 서버같은 저지연 환경이 요구되는 환경 |

<br>

### Framework: Spring Boot 3.4.4
이전 버전에 의존하는 레거시 요소가 없기 때문에 JDK 21의 기능들을 지원하는 최신 정식 릴리즈 버전인 3.4.4 버전을 선택했습니다.
- 본 프로젝트는 신규 개발이므로 처음부터 `jakarta.*` 기준으로 구성할 수 있습니다.
- JDK 21에서 도입된 최신 언어 및 플랫폼 기능은 Spring Boot 3.x 이상에서만 공식 지원됩니다.

| 항목          | Spring Boot 2.X               | Spring Boot 3.X                         |
|----------------|-------------------------------|--------------------------------------|
| JDK 호환        | 8-17 지원                      | 17 이상만 지원                          |
| 기반 프레임워크    | Spring Framework 5.x          | Spring Framework 6.x                 |
| API 네임스페이스   | `javax.*`                      | `jakarta.*`                        | 
| 네이티브 이미지    | GraalVM 제한적 지원              | GraalVM 네이티브 이미지 정식 지원          | 
| Virtual Thread | 미지원                          | 완벽 지원 (Thread Pool 대체 가능)         | 
| 라이브러리        | `javax.*` 기반의 외부 라이브러리와 호환성이 높음          |  `javax.*` 기반의 일부 라이브러리에서 호환성 이슈 발생 가능   | 

<br>

### Database: MySQL 8.0
본 프로젝트는 상업용이 아니며 비교적 단순한 조인 구조와 단건/범위 조회 패턴이 많고 쓰기보다 읽기 중심의 어플리케이션 입니다. 따라서 클러스터드 인덱스의 읽기 성능과 활용되기 쉬운 커버링 인덱스를 장점으로 생각해 MySQL로 선택했습니다. 

| 항목          | MySQL                            | PostgreSQL                               | MariaDB                                 |
|--------------|----------------------------------|--------------------------------------|--------------------------------------------|
| 스토리지       | InnoDB (PK 기반 클러스터드 인덱스 구조) | Heap 기반 테이블 구조                    | InnoDB, Aria, ColumnStore 등 다중 스토리지 엔진     |
| 인덱스 타입     | B+Tree, 전문검색, 공간인덱스 등        | B-Tree, GIN, GiST 등                 | B+Tree, 전문검색, 공간인덱스 등                  |
| 클러스터드 인덱스 | 기본 지원 (PK 기반 클러스터드 인덱스 + 보조 인덱스) | 기본 미지원 (CLUSTER 명령으로 일회성 클러스터링만 가능) | 기본 지원 (PK 기반 클러스터드 인덱스 + 보조 인덱스) |
| 보조 인덱스     | PK 참조  (PK 크기가 보조인덱스 크기에 영향을 미침)   | TID(Heap Tuple ID)를 참조해 원본 행 조회   | PK 참조 (PK 크기가 보조인덱스 크기에 영향을 미침)        |
| 커버링 인덱스    | 강력 지원 (보조 인덱스에 PK 포함)       | 제한적 (include 구문 필요)              | 강력 지원 (보조 인덱스에 PK 포함)          |
| 옵티마이저      | 비용 기반(제한적 통계수집, 히스토그램) | 고급 비용 기반(통계도 다변량, 히스토그램, 조인 재정렬, 인덱스 선택) | 향상된 비용 기반(MySQL보다 개선된 통계수집, 서브쿼리 최적화) |
| MVCC         | - 언두 로그 기반 <br>- 트랜잭션 단위 스냅샷 <br>- Vacuum 불필요 <br>- 언두 로그만 읽음   | - 튜플 버전 기반 <br>-쿼리 단위 스냅샷 <br>- Vacuum 필요 <br>- 튜플마다 visible 여부 판별    | - 언두 로그 기반 <br>- 트랜잭션 단위 스냅샷 <br>- Vacuum 불필요 <br>- 언두 로그만 읽음      |
| 연결 처리 방식    | One-thread-per-connection 모델<br>Thread Pool은 Enterprise Edition에서만 제공 | Process-per-connection 모델<br>각 연결마다 별도 프로세스 생성<br>연결 간 격리성 향상, OS 수준 메모리 보호<br>스레드보다 메모리 오버헤드가 크고 컨텍스트 스위칭 비용이 높음 | Thread Pool이 Community Edition에서도 기본 제공 |
| Json Type    | -네이티브 JSON 데이터 타입 지원 (5.7+)<br>-바이너리 형태로 최적화 저장 및 인덱싱 가능 | -네이티브 JSON과 JSONB(바이너리) 타입 모두 지원<br>-가장 풍부한 JSON 기능 및 인덱싱 | -네이티브 JSON 타입 없음<br>-LONGTEXT와 JSON 함수로 처리 |
| 읽기 성능    | -단순 쿼리와 PK 검색에 매우 우수<br>-클러스터드 인덱스가 범위 스캔에 최적화<br>-커버링 인덱스로 성능 향상       | -복잡한 분석 쿼리와 조인에 우수<br>-대용량 데이터셋에서 고급 쿼리 성능 탁월<br>-복잡한 필터링에 강점             | MySQL과 유사하며 단순 쿼리에 최적화         |
| 쓰기 성능    | -단일 행 삽입에 효율적<br>-트랜잭션 커밋 시 디스크 동기화 필요       | -COPY 명령어로 벌크 삽입 최적화<br>-동시 쓰기 처리에 강점              | MySQL과 유사한 쓰기 성능         |
| 라이센스 비용    | 이중 라이센스 모델<br>- Community Edition: GPL(무료)<br>- Enterprise Edition: 상용(유료) | 완전 오픈소스(PostgreSQL License/BSD-like)<br>모든 기능 무료 | GPL v2 라이센스<br>대부분의 엔터프라이즈 기능도 무료 버전에 포함 |


<br>

### 데이터 접근 기술: JPA
본 프로젝트는 현재 복잡한 동적 쿼리나 대량 데이터 처리가 요구되지 않으며 이는 기술 선택 시 중요한 고려 요소였습니다. 향후 대량 데이터를 처리해야 하는 상황이 발생하더라도 JPA의 한계를 보완할 수 있는 `JdbcTemplate` 또는 `native query` 를 사용할 수 있기 때문에 엔티티 클래스와 테이블 간의 매핑 자동화로 도메인 모델과 데이터베이스 스키마가 일치하도록 구성할 수 있고 반복적인 CRUD 쿼리를 자동 생성 자동생성함으로써 개발 생산성을 향상시킬 수 있는 ORM 프레임워크 JPA를 선택했습니다.

| 항목          | JPA                            | MyBatis                               | JDBC Template                              |
|--------------|--------------------------------|---------------------------------------|--------------------------------------------|
| 단순 CRUD     | 자동 생성                        | SQL 작성 필요                            | SQL 작성 필요                                |
| 동적 쿼리      | JPQL, QueryDSL 등 필요           | XML, 어노테이션 기반 지원                  | 문자열 직접 조합 필요                           |
| 객체-테이블 매핑 | 자동 (Entity = Table)           | 수동 매핑                                | 수동 매핑                                    |
| 생산성         | 단순 CRUD 자동                   | CRUD의 반복 작성이 필요하지만 SQL 유연함       | 모든 SQL과 매핑 수동 구현                      |
| 성능 튜닝       | 2차 캐시, Fetch 전략, 영속성 컨텍스트 등 ORM 전용 최적화 가능  | SQL 튜닝 자유롭지만 연관관계 최적화, 캐싱 수동 | SQL 단위 튜닝            |
| 대량 데이터 처리 | persist 반복 + flush/clear 필요  | foreach + <insert> 태그로 처리 가능         | batchUpdate()로 처리 가능                   |

<br>

### 동적 쿼리 기술: JPQL
QueryDSL은 타입 안전성과 리팩토링에 장점이 있지만 Q Class 생성의 번거로움, 빌드 시 apt 설정, 추가 라이브러리 의존성 등 설정이 복잡한 문제가 있습니다. 따라서 추가설정이나 플러그인이 필요없고 Java 텍스트 블록을 활용해 직관적인 문법을 제공하는 JPQL의 장점이 더 크다고 판단했습니다.

| 항목          | QueryDSL                            | JPQL                               | Criteria API                             |
|--------------|--------------------------------|---------------------------------------|--------------------------------------------|
| 타입 안정성     | 컴파일 시점 쿼리 오류 검출, 도메인 필드명 변경 자동 감지   | 문자열 기반으로 런타임 오류 발생 가능성 존재  | 컴파일 시점 체크                   |
| 빌드          | Q 클래스 생성을 위한 Annotation Processing Tool 설정 필요   | 별도 설정 없음             | 별도 설정 없음                         |
| Q Class      | 빌드시마다 Q 클래스 생성, 멀티모듈 시 공유 및 의존성 문제 발생  | 없음                         | 없음                                |
| 가독성         | 메서드 체이닝으로 유연하고 직관적 | 문자열 조합이지만 텍스트 블록을 활용하면 직관적            | Builder 패턴 중첩 많고 비교적 장황함           |
| 유지보수        | 필드 변경 시 Q타입 자동 반영, 조건 추출 및 재사용 용이 | 문자열 직접 수정이지만 단순쿼리 유지 용이 | 복잡한 구조때문에 유지보수 비용 높음          |

<br>

### 테스트: JUnit 5 + Mockito
Spock의 BDD 스타일, 강력한 파라미터화, 자체내장 Mocking은 매력적이었지만 Java 21의 최신 기능을 완벽하게 지원하고 Spring Boot와의 통합이 원활하며 풍부한 커뮤니티 자원과 레퍼런스를 제공한다는 점을 고려하여 JUnit 5를 선택했습니다. Mocking 라이브러리로는 직관적인 API, Spring의 @MockBean 통합, 활발한 커뮤니티 지원을 고려하여 Mockito를 선택했습니다.


| 항목          | JUnit 5                        | TestNG                                | Spock                                      |
|--------------|--------------------------------|---------------------------------------|--------------------------------------------|
| 기반 언어      | Java                           | Java                                  | Groovy                                     |
| 문법 스타일     | Java 표준, 람다/어노테이션 기반      | Java 표준, XML 설정                     | Groovy 기반의 BDD 스타일                      |
| Java 21 호환  | 호환                            | 호환                                   |  Groovy 기반으로 Java 최신 문법 제한             |
| Spring boot 호환 | Spring Boot 3.x 공식 지원     | 추가 설정 필요                            | 플러그인 필요                                 |
| Mocking      | 외부 라이브러리 필요                | 외부 라이브러리 필요                       | 자체 내장 Mocking DSL                        |
| 병렬 실행      | 선언적 설정 (junit-platform.properties) | parallel 속성, 설정 유연            | 제한적 (Groovy에서 병렬 처리 제약)              |
| Maven/Gradle 통합 | 기본 지원                    | 기본 지원                                | 플러그인 필요                                |
| 동적 테스트/파라미터화 | 지원 (@ParameterizedTest, @MethodSource 등) | 제한적 제공 (@DataProvider) | 기본 내장 지원                             |
| 실행 순서 제어   | @TestMethodOrder, @Order로 선언적 지원  | priority, dependsOnMethods 지원   | 명시적 실행 순서 제어 어려움                    |

| 항목          | Mockito                        | EasyMock                              | JMockit                                    |
|--------------|--------------------------------|---------------------------------------|--------------------------------------------|
| Mocking 방식  | 런타임 Proxy                     | Record → Replay 패턴 기반 프록시          | 런타임 바이트코드 조작                          |
| BDD 지원      | 지원 (given().willReturn())     | X                                     | 구조 자체가 BDD 기반                           |
| 개발 지원      | 활발한 개발, 커뮤니티               | 제한적 업데이트                           | 제한적 업데이트                                |
| Spring 통합   | @MockBean, @ExtendWith 등 공식 지원 | 직접 DI 필요                          | 제한적, 직접 설정 필요                          |
| JUnit 5 통합  | MockitoExtension으로 공식 지원     | 수동 설정 필요                           | 수동 설정 필요                                |
| TestNG 통합   | 수동 설정 필요                     | 수동 설정 필요                           | 수동 설정 필요                                |
| Static/Final Mocking | 3.4+부터 공식 지원        | X                                     |  지원                                       |

<br>

### Build Tool: Gradle
Maven도 안정적이고 널리 사용되는 빌드 도구이지만 본 프로젝트에서는 증분 빌드 및 빌드 캐시 기능을 활용하여 빌드 시간을 크게 단축시키고 Groovy/Kotlin DSL 기반의 유연한 빌드 스크립트 작성이 가능한 Gradle을 선택했습니다.

| 항목            | Gradle                        | Maven                                |
|----------------|-------------------------------|--------------------------------------|
| 문법            | Groovy, Kotlin DSL            | XML                                  |
| 증분 빌드        | 변경된 파일만 재컴파일              | 모듈 단위 빌드만 가능                     |
| 빌드 캐시        | 로컬 및 원격 캐시 제공             | 로컬 리포지토리 기반의 제한적 캐싱            | 
| 멀티 모듈 관리    | 유연한 구성과 설정 공유, 커스텀 의존성 로직 구현 용이 | 표준화된 접근 방식, POM 상속 구조로 다소 제한적 | 
| 플러그인 생태계    | 풍부하지만 비교적 최근             | 풍부하고 성숙함                           | 
| Java 21 지원    | 공식 지원                       | 공식 지원                               | 
| Spring 호환     | 공식 지원                       |  공식 지원                              | 
